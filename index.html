<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Calculadora de Notas — Fundamental e Médio</title>
<meta name="description" content="Calculadora de médias. Fundamental e Médio. Média Anual, P2 mínima e Tri mínimo. No Fundamental não há Exame Final.">
<style>
:root{
  --bg:#070a17; --bg2:#090d1f;
  --card:#0e1430; --glass:rgba(255,255,255,.04);
  --line:#212a56; --line2:#2b356b;
  --txt:#edf2ff; --muted:#9fb0ea; --muted2:#7b8ac3;
  --brand1:#6aa5ff; --brand2:#7ef7d4; --brand3:#b388ff;
  --ok:#19d49b; --warn:#ffb020; --bad:#ff6a6f;
  --shadow:0 18px 50px rgba(0,0,0,.55), inset 0 1px 0 rgba(255,255,255,.03);
  --radius:18px;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; color:var(--txt);
  font:16px/1.55 Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  background:
    radial-gradient(1300px 800px at -10% -10%, #1a2150 0%, rgba(26,33,80,0) 55%),
    radial-gradient(1100px 700px at 110% 0%, #14255a 0%, rgba(20,37,90,0) 55%),
    linear-gradient(180deg, var(--bg), var(--bg2));
  overflow-x:hidden;
}

/* orbes + rede sutil */
.orb{position:fixed; border-radius:50%; filter:blur(40px); opacity:.35; mix-blend-mode:screen; z-index:-2}
.o1{width:560px;height:560px;background:radial-gradient(circle at 30% 30%,#6aa5ff,transparent 60%);top:-160px;left:-140px;animation:f1 16s ease-in-out infinite}
.o2{width:620px;height:620px;background:radial-gradient(circle at 70% 40%,#7ef7d4,transparent 55%);bottom:-180px;right:-160px;animation:f2 19s ease-in-out infinite}
.o3{width:420px;height:420px;background:radial-gradient(circle at 50% 50%,#b388ff,transparent 60%);top:38%;left:58%;animation:f3 21s ease-in-out infinite}
@keyframes f1{0%,100%{transform:translate(0,0)}50%{transform:translate(30px,20px)}}
@keyframes f2{0%,100%{transform:translate(0,0)}50%{transform:translate(-36px,-26px)}}
@keyframes f3{0%,100%{transform:translate(0,0)}50%{transform:translate(-26px,22px)}}
.grid-bg{
  position:fixed; inset:0; background:
  linear-gradient(to right, rgba(255,255,255,.04) 1px, transparent 1px) 0 0/40px 40px,
  linear-gradient(to bottom, rgba(255,255,255,.04) 1px, transparent 1px) 0 0/40px 40px;
  mask-image: radial-gradient(1000px 600px at 50% 30%, #000 40%, transparent 80%);
  z-index:-1; opacity:.22;
}

.wrap{max-width:1200px;margin:0 auto;padding:32px 16px 64px}
header{text-align:center;margin-bottom:18px}
.kicker{display:inline-flex;gap:8px;align-items:center;padding:6px 12px;border:1px solid var(--line);border-radius:999px;background:linear-gradient(180deg,var(--glass),transparent);backdrop-filter:blur(6px);color:var(--muted);font-size:12px}
.logoDot{width:8px;height:8px;border-radius:50%;background:linear-gradient(90deg,var(--brand1),var(--brand3));box-shadow:0 0 14px rgba(106,165,255,.9)}
.title{margin:10px 0 6px;font-weight:900;font-size:clamp(24px,3.4vw,34px);letter-spacing:.2px}
.sub{margin:0;color:var(--muted);font-size:14px}

/* tabs */
.tabs{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-top:16px}
.tab{
  background:linear-gradient(180deg,#0d1333,#0a102b);
  border:1px solid var(--line);border-radius:14px;padding:10px 16px;
  font-weight:800;color:#dfe6ff;cursor:pointer;transition:.2s transform,.25s box-shadow,.25s background;
  box-shadow:0 10px 24px rgba(0,0,0,.35)
}
.tab:hover{transform:translateY(-1px)}
.tab.active{background:linear-gradient(90deg,var(--brand1),var(--brand3));color:#fff;box-shadow:0 0 22px rgba(106,165,255,.35)}

.layout{display:grid;grid-template-columns:1.15fr .85fr;gap:18px}
@media (max-width: 980px){.layout{grid-template-columns:1fr}}

/* cards */
.card{
  background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,0)), var(--card);
  border:1px solid var(--line); border-radius:var(--radius); box-shadow:var(--shadow)
}
.card .hd{padding:16px 18px;border-bottom:1px solid var(--line);display:flex;align-items:center;gap:10px}
.card .hd h2{margin:0;font-size:16px}
.card .bd{padding:18px}
.section-title{display:flex;align-items:center;justify-content:space-between;margin:6px 0 14px}

/* chips */
.actions{display:flex;gap:10px;flex-wrap:wrap}
.chip{
  position:relative; isolation:isolate;
  background:linear-gradient(180deg,#101743,#0d143a);
  border:1px solid var(--line2); color:#dfe6ff; padding:10px 14px;border-radius:999px;
  font-weight:800;cursor:pointer;transition:.12s transform,.2s border-color,.2s box-shadow,.2s background;
}
.chip::after{
  content:""; position:absolute; inset:0; border-radius:inherit; opacity:0; z-index:-1;
  background:radial-gradient(120px 60px at 50% 50%, #6aa5ff33, transparent 60%);
  transition:.2s opacity;
}
.chip:hover{transform:translateY(-1px);border-color:#3c65ff}
.chip:hover::after{opacity:1}
.chip.active{border-color:#3c65ff;box-shadow:0 0 0 3px rgba(60,101,255,.22) inset}

/* inputs */
label{display:block;font-size:12px;color:var(--muted);margin:0 0 6px 4px}
.inputs{display:grid;grid-template-columns:repeat(3,minmax(180px,1fr));gap:12px;margin-top:14px}
@media (max-width:700px){.inputs{grid-template-columns:1fr}}
.inputWrap{
  position:relative;border:1px solid var(--line);border-radius:14px;background:linear-gradient(180deg,var(--glass),transparent);
  transition:.2s border,.2s box-shadow
}
.inputWrap:focus-within{border-color:#3c65ff;box-shadow:0 0 0 4px rgba(60,101,255,.12)}
.inputIcon{position:absolute;left:10px;top:50%;transform:translateY(-50%);opacity:.8}
input{
  width:100%;padding:12px 12px 12px 36px;border:0;background:transparent;color:var(--txt);font-size:16px;outline:none
}
input::placeholder{color:#6e76a5}
.hint{font-size:12px;color:var(--muted2);margin-top:10px}
.sep{height:1px;background:linear-gradient(90deg,transparent,#2b356b,transparent);margin:16px 0}

/* botões */
.btns{display:flex;gap:10px;flex-wrap:wrap;margin-top:6px}
.btn{
  position:relative;isolation:isolate;
  border:1px solid #2a3567;background:linear-gradient(180deg,#1a2352,#121a45);
  color:#eaf0ff;padding:12px 14px;border-radius:12px;font-weight:900;cursor:pointer;
  transition:transform .12s ease,box-shadow .2s ease,border-color .2s ease;box-shadow:0 10px 22px rgba(17,24,39,.36)
}
.btn:hover{transform:translateY(-1px);border-color:#3c65ff}
.btn.ghost{background:transparent}
.btn.primary{
  background:linear-gradient(180deg,#12215a,#0f1a49);
  border-color:#3a5bff66; box-shadow:0 0 22px #3958ff22, inset 0 0 18px #6aa5ff15, inset 0 0 18px #b388ff15;
}
.btn .glow{content:"";position:absolute;inset:0;border-radius:inherit;z-index:-1;background:conic-gradient(from 0deg,rgba(106,165,255,.30),rgba(126,247,212,.30),rgba(179,136,255,.30),rgba(106,165,255,.30));filter:blur(18px);opacity:0;transition:.25s}
.btn:hover .glow{opacity:.8}

/* outputs */
.outs{display:grid;gap:12px}
.kpi{
  display:flex;align-items:center;gap:16px;background:linear-gradient(180deg,var(--glass),transparent);
  border:1px solid var(--line);border-radius:14px;padding:14px
}
.gauge{display:flex;align-items:center;gap:16px}
/* anel */
.ringWrap{width:160px;height:160px;position:relative}
.ringWrap svg{display:block;width:160px;height:160px}
.ringWrap circle{fill:none;stroke-width:12;stroke-linecap:round;transform:rotate(-90deg);transform-origin:50% 50%}
.ringWrap .bg{stroke:#1e2647}
.ringWrap .fg{stroke:url(#grad1);stroke-dasharray:427.26;stroke-dashoffset:427.26;transition:stroke-dashoffset .6s ease}
.ginfo{display:flex;flex-direction:column;gap:4px}
.gmain{font-size:30px;font-weight:900;letter-spacing:.3px}
.gsub{font-size:12px;color:#9fb0ea}
.status{font-size:13px;color:#var(--muted2)}
.centerMA{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;pointer-events:none}
.centerMA .big{font-size:24px;font-weight:900}
.centerMA .sub{font-size:11px;color:#9fb0ea;margin-top:2px;text-align:center}

.pill{
  display:flex;align-items:center;justify-content:space-between;gap:12px;
  background:linear-gradient(180deg,var(--glass),transparent);
  border:1px solid var(--line);padding:14px;border-radius:14px;font-variant-numeric:tabular-nums
}
.tag{font-size:12px;padding:4px 10px;border-radius:999px;border:1px solid var(--line);color:#9fb0ea}
.ok{color:var(--ok);border-color:#1b6a52;background:linear-gradient(180deg,rgba(13,214,140,.12),rgba(13,214,140,0))}
.bad{color:var(--bad);border-color:#6a1f28;background:linear-gradient(180deg,rgba(255,107,115,.12),rgba(255,107,115,0))}
.mid{color:var(--warn);border-color:#6a4e1f;background:linear-gradient(180deg,rgba(255,196,88,.12),rgba(255,196,88,0))}

.tableCard{background:linear-gradient(180deg,var(--glass),transparent);border:1px solid var(--line);border-radius:12px}
.tableCard table{width:100%;border-collapse:collapse}
.tableCard th,.tableCard td{padding:10px 12px;border-bottom:1px dashed #2b356b;text-align:left}
.tableCard th{color:#c9d6ff}
.tableCard tr:last-child td{border-bottom:0}

.toast{position:fixed;right:16px;bottom:16px;background:linear-gradient(180deg,#0f173d,#0b1234);color:#eaf0ff;border:1px solid #2a3567;border-radius:12px;padding:12px 14px;box-shadow:var(--shadow);opacity:0;transform:translateY(8px);pointer-events:none;transition:.3s}
.toast.show{opacity:1;transform:none}

/* assinatura */
.signature{position:fixed;right:14px;bottom:12px;font-size:12px;color:var(--muted);background:linear-gradient(180deg,#0b1130,#0a0f28);border:1px solid #223064;border-radius:999px;padding:6px 10px;opacity:.8}
.signature:hover{opacity:1}

/* Widget de versão */
.version{
  position:fixed;left:14px;bottom:12px;z-index:10;
  display:flex;align-items:center;gap:8px;
  padding:6px 10px;border-radius:999px;
  background:linear-gradient(180deg,#0b1130,#0a0f28);
  border:1px solid #223064;color:#9fb0ea;font-size:12px;opacity:.9
}
.version .dot{width:8px;height:8px;border-radius:999px;background:linear-gradient(90deg,var(--brand1),var(--brand3));box-shadow:0 0 14px rgba(106,165,255,.9)}
.version .tag{border-color:#2b356b;color:#dfe6ff}
.version:hover{opacity:1}
.version .carat{opacity:.7}
.version-panel{
  position:fixed;left:14px;bottom:48px;min-width:240px;
  background:linear-gradient(180deg,#0e1430,#0a102b);
  border:1px solid #223064;border-radius:14px;color:#dfe6ff;
  box-shadow:0 18px 50px rgba(0,0,0,.55);padding:10px;display:none
}
.version-panel h4{margin:4px 6px 8px;font-size:12px;color:#9fb0ea;font-weight:700}
.version-panel ul{list-style:none;margin:0;padding:0}
.version-panel li{padding:8px 10px;border:1px solid #223064;border-radius:10px;background:linear-gradient(180deg,rgba(255,255,255,.03),transparent);margin:6px 0}
.version-panel .vhead{display:flex;justify-content:space-between;color:#9fb0ea;font-size:12px;margin-bottom:4px}
.version-panel .vbody{font-size:12px;color:#c7d2ff}
.version.open + .version-panel{display:block}

.visually-hidden{position:absolute;left:-10000px;top:auto;width:1px;height:1px;overflow:hidden}
</style>
</head>
<body>
<div class="orb o1"></div><div class="orb o2"></div><div class="orb o3"></div><div class="grid-bg"></div>

<div class="wrap">
  <header>
    <span class="kicker"><span class="logoDot"></span> Calculadora de Notas</span>
    <h1 class="title">Ensino Fundamental & Ensino Médio</h1>
    <p class="sub">Colégio Weber Dehon</p>
    <div class="tabs" role="tablist" aria-label="Modos">
      <button id="tabFund" class="tab active" role="tab" aria-selected="true" aria-controls="panelFund" onclick="setTab('fund')">Ensino Fundamental</button>
      <button id="tabMed"  class="tab" role="tab" aria-selected="false" aria-controls="panelMed"  onclick="setTab('med')">Ensino Médio</button>
    </div>
  </header>

  <main class="layout">
    <!-- Entradas -->
    <section class="card" aria-labelledby="inTitle">
      <div class="hd"><h2 id="inTitle">Entradas</h2></div>
      <div class="bd">
        <div class="actions" id="actions"></div>
        <div class="sep"></div>
        <div id="inputsArea" class="inputs"></div>
        <p class="hint">Notas entre 0 e 10.</p>
        <div class="sep"></div>
        <div class="btns">
          <button class="btn primary" id="btnCalc"><span class="glow"></span>Calcular</button>
          <button class="btn ghost" id="btnLimpar"><span class="glow"></span>Limpar</button>
          <button class="btn ghost" id="btnExemplo"><span class="glow"></span>Exemplo</button>
        </div>
      </div>
    </section>

    <!-- Resultados -->
    <section class="card" aria-labelledby="outTitle">
      <div class="hd"><h2 id="outTitle">Resultados</h2></div>
      <div class="bd outs">
        <div class="kpi">
          <div class="gauge">
            <div class="ringWrap">
              <svg viewBox="0 0 160 160" aria-hidden="true">
                <defs>
                  <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="0%">
                    <stop offset="0%" stop-color="#6aa5ff"/>
                    <stop offset="50%" stop-color="#7ef7d4"/>
                    <stop offset="100%" stop-color="#b388ff"/>
                  </linearGradient>
                </defs>
                <circle class="bg" cx="80" cy="80" r="68"></circle>
                <circle class="fg" id="fg" cx="80" cy="80" r="68"></circle>
              </svg>
              <div class="centerMA">
                <div style="display:flex;flex-direction:column;align-items:center">
                  <div class="big" id="maCenter">—</div>
                  <div class="sub" id="maLegend">Média Anual</div>
                </div>
              </div>
            </div>
            <div class="ginfo">
              <div class="gmain" id="maVal">MA —</div>
              <div class="gsub" id="gsub">Meta: 7,00</div>
              <div class="status" id="status">Status: —</div>
            </div>
          </div>
        </div>

        <div class="pill"><div>Resultado principal</div><div class="tag" id="mainTag">—</div></div>
        <div class="pill" id="t3calcRow" style="display:none"><div>T3</div><div class="tag" id="t3calcTag">—</div></div>
        <div class="pill" id="efRow"><div>Exame Final</div><div class="tag" id="efTag">—</div></div>

        <div class="tableCard">
          <table>
            <thead>
              <tr><th>Parâmetro</th><th>Valor</th><th>Descrição</th></tr>
            </thead>
            <tbody id="tbl"></tbody>
          </table>
        </div>
      </div>
    </section>
  </main>
</div>

<div id="toast" class="toast" role="status" aria-live="polite">Ok</div>
<div class="signature">Site feito por: @luizgmrzzx</div>

<!-- Widget de Versão -->
<button id="versionBtn" class="version" aria-expanded="false" aria-controls="versionPanel" title="Versões do site">
  <span class="dot"></span>
  <span>Versão</span>
  <span id="versionTag" class="tag">—</span>
  <svg class="carat" width="12" height="12" viewBox="0 0 24 24" aria-hidden="true"><path fill="#9fb0ea" d="M7 10l5 5 5-5z"/></svg>
</button>
<div id="versionPanel" class="version-panel" role="dialog" aria-label="Histórico de versões">
  <h4>Histórico</h4>
  <ul id="versionList"></ul>
</div>

<script>
/* ===== Util ===== */
const $=s=>document.querySelector(s), $$=s=>document.querySelectorAll(s);
const fmt=n=>Number.isFinite(n)?n.toLocaleString('pt-BR',{minimumFractionDigits:2,maximumFractionDigits:2}):'—';
const R=68, CIRC=2*Math.PI*R;
function setGauge(ratio){
  const r=Math.max(0,Math.min(1,ratio));
  $('#fg').style.strokeDashoffset=(CIRC*(1-r)).toFixed(2);
}
function toast(msg){const t=$('#toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),1500)}
function toNum(s){if(typeof s!=='string')return NaN;const t=s.trim().replace(/\s+/g,'').replace(',','.');const n=Number(t);return Number.isFinite(n)?n:NaN}
function read(id){return toNum($('#'+id)?.value??'')}
function setTag(id,val,kind){const el=$(id);el.textContent=val;el.className='tag'+(kind?' '+kind:'')}
function setTable(rows){$('#tbl').innerHTML=rows.map(([k,v,o])=>`<tr><td>${k}</td><td>${v}</td><td>${o||''}</td></tr>`).join('')}

/* ===== Parâmetros ===== */
const META=7;

/* Médio (mantido) */
const MA_medio=(T1,T2,T3)=>(2*T1+2*T2+3*T3)/7;
const T3_medio=(P1,P2,S)=>(P1+P2+2*S)/2;
function EF_minimo(MA){ return (50 - 7*MA)/3 }
function P2min_medio(T1,T2,P1,S,goalMA){const T3need=(7*goalMA-2*T1-2*T2)/3;return {T3need, P2min: 2*T3need-P1-2*S}}

/* Fundamental (atualizado) */
const TX_fund=(P1,P2,Tri,S)=>(P1+P2+Tri+3*S)/3;
const MA_fund=(T1,T2,Tx)=>(1*T1+1*T2+1.5*Tx)/3;
/* Tri mínima para atingir MA=7,0 no modelo completo (usa P1,P2,S e resolve Tri) */
function TRIMIN_fund_MA(T1,T2,P1,P2,S){return 6*META - 2*T1 - 2*T2 - P1 - P2 - 3*S}

/* ===== Estado ===== */
let TAB='fund';         // 'fund' | 'med'
let ACTION='fund_full'; // 'fund_full' | 'fund_tri_min' | 'med_full' | 'med_p2_min'

/* ===== UI ===== */
function setTab(t){
  TAB=t;
  $('#tabFund').classList.toggle('active',t==='fund');
  $('#tabMed').classList.toggle('active',t==='med');
  renderActions(); renderInputs(); clearOutputs(); toggleEFRow();
}

function renderActions(){
  const box=$('#actions');
  if(TAB==='fund'){
    ACTION=ACTION.startsWith('fund_')?ACTION:'fund_full';
    box.innerHTML=`
      <button type="button" class="chip" data-act="fund_full">Média Anual</button>
      <button type="button" class="chip" data-act="fund_tri_min">Tri mínimo</button>`;
  }else{
    ACTION=ACTION.startsWith('med_')?ACTION:'med_full';
    box.innerHTML=`
      <button type="button" class="chip" data-act="med_full">Média Anual</button>
      <button type="button" class="chip" data-act="med_p2_min">P2 mínima</button>`;
  }
  [...box.querySelectorAll('.chip')].forEach(btn=>{
    btn.classList.toggle('active',btn.dataset.act===ACTION);
    btn.addEventListener('click',()=>{
      ACTION=btn.dataset.act;
      [...box.querySelectorAll('.chip')].forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      clearOutputs(); renderInputs(); toggleEFRow();
    });
  });
}

function field(id,label,ph,iconColor='#8aa1ff'){
  return `
  <div>
    <label for="${id}">${label}</label>
    <div class="inputWrap">
      <svg class="inputIcon" width="18" height="18" viewBox="0 0 24 24"><path fill="${iconColor}" d="M5 3h14v2H5zm0 8h14v2H5zm0 8h14v2H5z"/></svg>
      <input id="${id}" placeholder="${ph}">
    </div>
  </div>`;
}

function renderInputs(){
  const a=$('#inputsArea');
  if(TAB==='fund'){
    if(ACTION==='fund_full'){
      a.innerHTML=
        field('t1','T1','ex.: 7,0')+
        field('t2','T2','ex.: 8,0')+
        field('p1','P1','ex.: 6,5','#86f7d9')+
        field('p2','P2','ex.: 7,2','#86f7d9')+
        field('tri','Tri (trimestral)','ex.: 4,0','#b388ff')+
        field('s','S (simulado)','ex.: 0,7','#ffd479');
    }else{ // fund_tri_min -> entradas P1, P2 e S
      a.innerHTML=
        field('t1','T1','ex.: 7,0')+
        field('t2','T2','ex.: 8,0')+
        field('p1','P1','ex.: 6,5','#86f7d9')+
        field('p2','P2','ex.: 7,2','#86f7d9')+
        field('s','S (simulado)','ex.: 0,7','#ffd479');
    }
  }else{
    if(ACTION==='med_full'){
      a.innerHTML=
        field('t1','T1','ex.: 6,5')+
        field('t2','T2','ex.: 7,8')+
        field('t3','T3','ex.: 7,0','#86f7d9');
    }else{
      a.innerHTML=
        field('t1','T1','ex.: 6,8')+
        field('t2','T2','ex.: 7,2')+
        field('p1','P1','ex.: 6,4','#86f7d9')+
        field('p2','P2','ex.: 6,8','#86f7d9')+
        field('s','S (simulado)','ex.: 0,8','#ffd479');
    }
  }
}

function toggleEFRow(){
  // No Fundamental: esconder Exame Final. No Médio: mostrar.
  const showEF = (TAB==='med');
  $('#efRow').style.display = showEF ? '' : 'none';
}

/* ===== Lógica ===== */
function clearOutputs(){
  $('#maVal').textContent='MA —';
  $('#maCenter').textContent='—';
  $('#maLegend').textContent='Média Anual';
  $('#gsub').textContent='Meta: 7,00';
  $('#status').textContent='Status: —';
  setTag('#mainTag','—');
  setTag('#efTag','—');
  $('#t3calcRow').style.display='none';
  setTag('#t3calcTag','—');
  setGauge(0); setTable([]);
}

$('#btnCalc').addEventListener('click', ()=>{
  const T1=read('t1'), T2=read('t2'), T3=read('t3');
  const P1=read('p1'), P2=read('p2'), S=read('s'), TRI=read('tri');

  function need(vals){
    if(vals.some(v=>!Number.isFinite(v))){toast('Preencha os campos necessários');return false}
    if(vals.some(v=>v<0||v>10)){toast('Notas devem estar entre 0 e 10');return false}
    return true;
  }

  // MÉDIO — média anual
  if(TAB==='med' && ACTION==='med_full'){
    if(!need([T1,T2,T3]))return;
    const MA=MA_medio(T1,T2,T3);
    const EF=EF_minimo(MA);
    showResultsMedio(MA, EF, [['MA',fmt(MA),'Média anual']]);
    return;
  }

  // MÉDIO — P2 mínima
  if(TAB==='med' && ACTION==='med_p2_min'){
    if(!need([T1,T2,P1,S]))return;
    const {T3need, P2min}=P2min_medio(T1,T2,P1,S,META);

    let rows=[
      ['T3 necessário',fmt(T3need),'para atingir MA 7,0'],
      ['P2 mínima',fmt(P2min), P2min>10?'>10 impossível':(P2min<=0?'já aprovado com P1 e S':'alcançar')]
    ];

    let MAshow = NaN, EFshow = 0;
    $('#t3calcRow').style.display='none';
    $('#maLegend').textContent='Média Anual';

    if(Number.isFinite(P2)){
      const T3cur=T3_medio(P1,P2,S);
      const MAcur=MA_medio(T1,T2,T3cur);
      MAshow = MAcur;
      EFshow = EF_minimo(MAcur);
      setTag('#t3calcTag',fmt(T3cur),'');
      $('#t3calcRow').style.display='';
      rows.push(['T3',fmt(T3cur),'de P1, P2 e S']);
    }

    showResultsMedio(MAshow, EFshow, rows, P2min);
    return;
  }

  // FUNDAMENTAL — média anual (sem Exame Final)
  if(TAB==='fund' && ACTION==='fund_full'){
    if(!need([T1,T2,P1,P2,TRI,S]))return;
    const TX=TX_fund(P1,P2,TRI,S);
    const MA=MA_fund(T1,T2,TX);
    showResultsFundamental({
      mainLabel:`MA ${fmt(MA)}`,
      mainKind:(MA>=META?'ok':'bad'),
      maValue:MA,
      maLegend:'Média Anual',
      status:MA>=META?'aprovado':'abaixo da meta',
      table:[['Média do 3º',fmt(TX),'Calculada']],
      triMin:null
    });
    return;
  }

  // FUNDAMENTAL — Tri mínimo com P1, P2 e S; exibir MA como "Média Anual"
  if(TAB==='fund' && ACTION==='fund_tri_min'){
    if(!need([T1,T2,P1,P2,S]))return;
    const T3min = Math.max(0, Math.min(10, TRIMIN_fund_MA(T1,T2,P1,P2,S)));
    const TX = TX_fund(P1,P2,T3min,S);
    const MAprev = MA_fund(T1,T2,TX);
    showResultsFundamental({
      mainLabel:`Tri mínima ${fmt(T3min)}`,
      mainKind: (T3min>10?'bad':(T3min<=0?'ok':'mid')),
      maValue:MAprev,
      maLegend:'Média Anual',
      status: MAprev>=META ? 'aprovado' : 'abaixo da meta',
      table:[['T3 mínima necessária', fmt(T3min), 'Nota mínima no 3º trimestre para atingir a meta']],
      triMin:T3min
    });
    return;
  }
});

/* ===== Saídas ===== */
function showResultsMedio(MA, EF, rows, P2min=null){
  const maTxt=Number.isFinite(MA)?fmt(MA):'—';
  $('#maVal').textContent=`MA ${maTxt}`;
  $('#maCenter').textContent=maTxt;
  $('#maLegend').textContent='Média Anual';
  $('#gsub').textContent=`Meta: 7,00`;

  const ok=Number.isFinite(MA)?(MA>=META):null;
  $('#status').textContent=Number.isFinite(MA)?(ok?'Status: aprovado':'Status: abaixo da meta'):'Status: —';

  let mainLabel = Number.isFinite(MA) ? (ok?`MA ${fmt(MA)} ✔`:`MA ${fmt(MA)} ✖`) : '—';
  let mainKind = ok==null?'':(ok?'ok':'bad');

  if(P2min!==null){
    mainLabel = P2min>10?`P2 mínima ${fmt(P2min)} (impossível)`:(P2min<=0?`P2 mínima 0,00`:`P2 mínima ${fmt(P2min)}`);
    mainKind = P2min>10?'bad':(P2min<=0?'ok':'mid');
  }
  setTag('#mainTag', mainLabel, mainKind);

  if(!Number.isFinite(EF)) EF = 0;
  let efKind='mid';
  if(Number.isFinite(MA) && MA>=7) { EF=0; efKind='ok'; }
  else if(EF<=0){ EF=0; efKind='ok'; }
  else if(EF>10){ efKind='bad'; }
  setTag('#efTag', fmt(EF), efKind);

  setGauge(Number.isFinite(MA)?Math.min(1,Math.max(0,MA/META)):0);
  setTable(rows);
  $('#t3calcRow').style.display='none';
}

function showResultsFundamental({mainLabel, mainKind, maValue, maLegend, status, table}){
  setTag('#mainTag', mainLabel, mainKind);
  setTag('#efTag','—');
  $('#efRow').style.display='none';

  const maTxt=Number.isFinite(maValue)?fmt(maValue):'—';
  $('#maVal').textContent=`MA ${maTxt}`;
  $('#maCenter').textContent=maTxt;
  $('#maLegend').textContent=maLegend || 'Média Anual';
  $('#gsub').textContent=`Meta: 7,00`;
  $('#status').textContent=Number.isFinite(maValue)?(`Status: ${status}`):'Status: —';

  setGauge(Number.isFinite(maValue)?Math.min(1,Math.max(0,maValue/META)):0);
  setTable(table || []);
  $('#t3calcRow').style.display='none';
}

/* limpar e exemplo */
$('#btnLimpar').addEventListener('click',()=>{
  $$('#inputsArea input').forEach(i=>i.value='');
  clearOutputs(); toast('Campos limpos')
});
$('#btnExemplo').addEventListener('click',()=>{
  if(TAB==='med'){
    if(ACTION==='med_full'){
      $('#t1').value='6,50';$('#t2').value='7,80';$('#t3').value='7,00';
    }else{
      $('#t1').value='6,80';$('#t2').value='7,20';$('#p1').value='6,40';$('#p2').value='6,80';$('#s').value='0,80';
    }
  }else{
    if(ACTION==='fund_full'){
      $('#t1').value='7,00';$('#t2').value='8,00';$('#p1').value='6,50';$('#p2').value='7,20';$('#tri').value='4,00';$('#s').value='0,70';
    }else{
      $('#t1').value='7,20';$('#t2').value='7,80';$('#p1').value='6,50';$('#p2').value='7,10';$('#s').value='0,70';
    }
  }
  toast('Exemplo preenchido');
});

/* ===== Versões ===== */
const CURRENT_VERSION = "1.2";
const VERSIONS = [
  { v:"1.2", date:"2025-11-05", notes:"Fundamental (Tri mínimo): entradas P1, P2 e S; rótulo exibindo MA como 'Média Anual'." },
  { v:"1.1", date:"2025-11-05", notes:"Fundamental: removido Exame Final; Tri mínimo com cálculo e status; tabela só com T3." },
  { v:"1.0", date:"2025-11-05", notes:"Release inicial com Fundamental e Médio. P2 mínima e EF no Médio." },
];

function mountVersions(){
  $('#versionTag').textContent = CURRENT_VERSION;
  const ul = $('#versionList');
  ul.innerHTML = VERSIONS.map(it=>`
    <li>
      <div class="vhead"><span>v${it.v}</span><span>${it.date}</span></div>
      <div class="vbody">${it.notes}</div>
    </li>`).join('');
  const btn = $('#versionBtn');
  const panel = $('#versionPanel');
  function toggle(open){
    btn.classList.toggle('open',open);
    btn.setAttribute('aria-expanded', String(open));
    panel.style.display = open ? 'block' : 'none';
  }
  btn.addEventListener('click', (e)=>{ e.stopPropagation(); toggle(btn.getAttribute('aria-expanded')==='false'); });
  document.addEventListener('click', ()=> toggle(false));
}

function init(){ setTab('fund'); mountVersions(); }
init();
</script>
</body>
</html>
